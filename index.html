<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å§“åç‚¹å‡»æŒ‘æˆ˜ï¼ˆå«ç‚¹é”™æƒ©ç½šï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style type="text/tailwindcss">
    body {
      @apply font-sans bg-gradient-to-br from-purple-50 to-green-50 min-h-screen flex flex-col;
    }
    .char-tile {
      @apply flex items-center justify-center cursor-pointer transition-all duration-300 bg-white rounded-lg shadow-md hover:shadow-lg aspect-square text-3xl font-bold;
    }
    .char-tile-found {
      @apply opacity-0 pointer-events-none;
    }
    .char-tile-selected {
      @apply ring-2 ring-indigo-500 ring-offset-2;
    }
    .char-tile-wrong {
      @apply bg-red-100 text-red-500; /* ç‚¹é”™çš„è§†è§‰åé¦ˆ */
    }
  </style>
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <nav class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <svg class="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 4v16l12-8-12-8z"/>
        </svg>
        <h1 class="text-lg font-bold text-gray-800">å§“åç‚¹å‡»æŒ‘æˆ˜</h1>
      </div>
      <div class="hidden md:flex space-x-4">
        <a href="#join" class="text-gray-600 hover:text-indigo-500">å¼€å§‹æ¸¸æˆ</a>
        <a href="#ranking" class="text-gray-600 hover:text-indigo-500">æ’è¡Œæ¦œ</a>
      </div>
    </div>
  </nav>

  <!-- åŠ å…¥æ¸¸æˆ -->
  <section id="join" class="max-w-md mx-auto my-12 px-4">
    <div class="bg-white rounded-lg shadow-lg p-6 text-center">
      <h2 class="text-xl font-bold text-gray-800 mb-4">å¼€å§‹æŒ‘æˆ˜</h2>
      <p class="text-gray-600 mb-6">è¾“å…¥å§“åï¼ŒæŒ‘æˆ˜æ‰­æ›²æ–‡å­—ï¼<br>ç‚¹é”™ä¼šæ‰£æ—¶é—´å“¦ï¼</p>
      <form id="join-form" class="space-y-4">
        <input type="text" id="player-name" 
               class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
               placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
        <button type="submit" 
                class="w-full py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 transition-colors">
          å¼€å§‹æ¸¸æˆ
        </button>
      </form>
    </div>
  </section>

  <!-- æ¸¸æˆç•Œé¢ -->
  <section id="game" class="max-w-4xl mx-auto my-12 px-4 hidden">
    <div class="bg-white rounded-lg shadow-lg p-6">
      <!-- é¡¶éƒ¨ä¿¡æ¯ -->
      <div class="flex flex-col md:flex-row justify-between items-center mb-4">
        <div>
          <p class="text-gray-600">ç©å®¶ï¼š<span id="current-player" class="text-indigo-500 font-semibold"></span></p>
        </div>
        <div class="flex space-x-6">
          <div>
            <p class="text-gray-600">å·²æ‰¾åˆ°ï¼š</p>
            <p class="text-xl font-bold text-green-500" id="found-count">0</p>
          </div>
          <div>
            <p class="text-gray-600">å‰©ä½™æ—¶é—´ï¼š</p>
            <p class="text-xl font-bold text-yellow-500" id="time-left">60</p>
          </div>
        </div>
      </div>

      <!-- è¿›åº¦æ¡ -->
      <div class="h-2 bg-gray-200 rounded-md mb-6">
        <div id="progress-bar" class="h-full bg-green-500 rounded-md" style="width: 100%"></div>
      </div>

      <!-- å½“å‰ç›®æ ‡å§“å -->
      <div class="text-center mb-6">
        <p class="text-gray-600 mb-2">æ‰¾åˆ°è¿™ä¸ªå§“åï¼š</p>
        <h3 class="text-2xl font-bold text-indigo-500" id="target-name">åŠ è½½ä¸­...</h3>
      </div>

      <!-- æ±‰å­—ç½‘æ ¼ -->
      <div id="game-content" class="grid grid-cols-4 gap-3 mb-8"></div>

      <!-- æ¸¸æˆç»“æŸç»“æœ -->
      <div id="game-over" class="hidden text-center py-8">
        <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fa fa-trophy text-indigo-500 text-2xl"></i>
        </div>
        <h2 class="text-xl font-bold text-gray-800 mb-2">æ—¶é—´åˆ°ï¼</h2>
        <p class="text-gray-600 mb-6">ä½ æ‰¾åˆ°äº† <span id="final-count" class="text-indigo-500 font-bold">0</span> ä¸ªå§“å</p>
        <button id="save-score" 
                class="px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 transition-colors">
          ä¿å­˜æˆç»©
        </button>
      </div>
    </div>
  </section>

  <!-- æ’è¡Œæ¦œ -->
  <section id="ranking" class="max-w-4xl mx-auto my-12 px-4">
    <div class="bg-white rounded-lg shadow-lg p-6">
      <div class="text-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">æŒ‘æˆ˜æ’è¡Œæ¦œ</h2>
        <p class="text-gray-600">çœ‹çœ‹è°æ˜¯æ‰¾åè¾¾äºº</p>
      </div>
      <table class="w-full text-left">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-2 text-gray-500">æ’å</th>
            <th class="px-4 py-2 text-gray-500">ç©å®¶</th>
            <th class="px-4 py-2 text-gray-500">æ‰¾åˆ°æ•°é‡</th>
            <th class="px-4 py-2 text-gray-500">æ—¶é—´</th>
          </tr>
        </thead>
        <tbody id="ranking-body">
          <tr>
            <td colspan="4" class="text-center py-6 text-gray-400">æš‚æ— æ•°æ®</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <script>
    // é…ç½®ï¼šå§“ååº“ + å¹²æ‰°å­—åº“
    const nameList = [
      'å¼ ä¸‰','æå››','ç‹äº”','èµµå…­','é’±ä¸ƒ','å­™å…«','å‘¨ä¹','å´å',
      'éƒ‘ä¸€','ç‹äºŒ','é™ˆä¸‰','åˆ˜å››','æ¨äº”','é»„å…­','èµµä¸ƒ','å´å…«'
    ];
    const commonChars = 'çš„ä¸€æ˜¯åœ¨ä¸äº†æœ‰å’Œäººè¿™ä¸­å¤§ä¸ºä¸Šä¸ªå›½æˆ‘ä»¥è¦ä»–æ—¶æ¥ç”¨ä»¬ç”Ÿåˆ°ä½œåœ°äºå‡ºå°±åˆ†å¯¹æˆä¼šå¯ä¸»å‘å¹´åŠ¨åŒå·¥ä¹Ÿèƒ½ä¸‹è¿‡å­è¯´äº§ç§é¢è€Œæ–¹åå¤šå®šè¡Œå­¦æ³•æ‰€æ°‘å¾—ç»åä¸‰ä¹‹è¿›ç€ç­‰éƒ¨åº¦å®¶ç”µåŠ›é‡Œå¦‚æ°´åŒ–é«˜è‡ªäºŒç†èµ·å°ç‰©ç°å®åŠ é‡éƒ½ä¸¤ä½“åˆ¶æœºå½“ä½¿ç‚¹ä»ä¸šæœ¬å»æŠŠæ€§å¥½åº”å¼€å®ƒåˆè¿˜å› ç”±å…¶äº›ç„¶å‰å¤–å¤©æ”¿å››æ—¥é‚£ç¤¾ä¹‰äº‹å¹³å½¢ç›¸å…¨è¡¨é—´æ ·ä¸å…³å„é‡æ–°çº¿å†…æ•°æ­£å¿ƒåä½ æ˜çœ‹åŸåˆä¹ˆåˆ©æ¯”æˆ–ä½†è´¨æ°”ç¬¬å‘é“å‘½æ­¤å˜æ¡åªæ²¡ç»“è§£é—®æ„å»ºæœˆå…¬æ— ç³»å†›å¾ˆæƒ…è€…æœ€ç«‹ä»£æƒ³å·²é€šå¹¶æç›´é¢˜å…šç¨‹å±•äº”æœæ–™è±¡å‘˜é©ä½å…¥å¸¸æ–‡æ€»æ¬¡å“å¼æ´»è®¾åŠç®¡ç‰¹ä»¶é•¿æ±‚è€å¤´åŸºèµ„è¾¹æµè·¯çº§å°‘å›¾å±±ç»Ÿæ¥çŸ¥è¾ƒå°†ç»„è§è®¡åˆ«å¥¹æ‰‹è§’æœŸæ ¹è®ºè¿å†œæŒ‡å‡ ä¹åŒºå¼ºæ”¾å†³è¥¿è¢«å¹²åšå¿…æˆ˜å…ˆå›åˆ™ä»»å–æ®å¤„é˜Ÿå—ç»™è‰²å…‰é—¨å³ä¿æ²»åŒ—é€ ç™¾è§„çƒ­é¢†ä¸ƒæµ·å£ä¸œå¯¼å™¨å‹å¿—ä¸–é‡‘å¢äº‰æµé˜¶æ²¹æ€æœ¯æäº¤å—è”ä»€è®¤å…­å…±æƒæ”¶è¯æ”¹æ¸…å·±ç¾å†é‡‡è½¬æ›´å•é£åˆ‡æ‰“ç™½æ•™é€ŸèŠ±å¸¦å®‰åœºèº«è½¦ä¾‹çœŸåŠ¡å…·ä¸‡æ¯ç›®è‡³è¾¾èµ°ç§¯ç¤ºè®®å£°æŠ¥æ–—å®Œç±»å…«ç¦»ååç¡®æ‰ç§‘å¼ ä¿¡é©¬èŠ‚è¯ç±³æ•´ç©ºå…ƒå†µä»Šé›†æ¸©ä¼ åœŸè®¸æ­¥ç¾¤å¹¿çŸ³è®°éœ€æ®µç ”ç•Œæ‹‰æ—å¾‹å«ä¸”ç©¶è§‚è¶Šç»‡è£…å½±ç®—ä½æŒéŸ³ä¼—ä¹¦å¸ƒå¤å®¹å„¿é¡»é™…å•†ééªŒè¿æ–­æ·±éš¾è¿‘çŸ¿åƒå‘¨å§”ç´ æŠ€å¤‡åŠåŠé’çœåˆ—ä¹ å“çº¦æ”¯èˆ¬å²æ„ŸåŠ³ä¾¿å›¢å¾€é…¸å†å¸‚å…‹ä½•é™¤æ¶ˆæ„åºœç§°å¤ªå‡†ç²¾å€¼å·ç‡æ—ç»´åˆ’é€‰æ ‡å†™å­˜å€™æ¯›äº²å¿«æ•ˆæ–¯é™¢æŸ¥æ±Ÿå‹çœ¼ç‹æŒ‰æ ¼å…»æ˜“ç½®æ´¾å±‚ç‰‡å§‹å´ä¸“çŠ¶è‚²å‚äº¬è¯†é€‚å±åœ†åŒ…ç«ä½è°ƒæ»¡å¿å±€ç…§å‚çº¢ç»†å¼•å¬è¯¥é“ä»·ä¸¥é¦–åº•æ¶²å®˜å¾·è°ƒéšç—…è‹å¤±å°”æ­»è®²é…å¥³é»„æ¨æ˜¾è°ˆç½ªç¥è‰ºå‘¢å¸­å«ä¼æœ›å¯†æ‰¹è¥é¡¹é˜²ä¸¾çƒè‹±æ°§åŠ¿å‘Šæå¼ ç‹åˆ˜é™ˆæ¨é»„èµµå´å‘¨å¾å­™é©¬æœ±èƒ¡æ—éƒ­ä½•é«˜ç½—éƒ‘æ¢è°¢å®‹å”è®¸éŸ©å†¯é‚“æ›¹å½­æ›¾è‚–ç”°è‘£è¢æ½˜äºè’‹è”¡ä½™æœå¶ç¨‹è‹é­å•ä¸ä»»æ²ˆå§šå¢å§œå´”é’Ÿè°­é™†æ±ªèŒƒé‡‘çŸ³å»–è´¾å¤éŸ¦å‚…æ–¹ç™½é‚¹å­Ÿç†Šç§¦é‚±æ±Ÿå°¹è–›é—«æ®µé›·ä¾¯é¾™å²é™¶é»è´ºé¡¾æ¯›éƒé¾šé‚µä¸‡é’±ä¸¥è¦ƒæ­¦æˆ´è«å­”å‘æ±¤';

    // æ¸¸æˆçŠ¶æ€
    let gameState = 'idle';
    let currentPlayer = 'æ¸¸å®¢';
    let timeLeft = 60;
    let timer = null;
    let foundCount = 0;
    let targetChars = [];
    let currentCharIndex = 0;
    let charGrid = [];

    // åˆå§‹åŒ–äº¤äº’
    document.addEventListener('DOMContentLoaded', () => {
      // å¼€å§‹æ¸¸æˆè¡¨å•
      document.getElementById('join-form').addEventListener('submit', (e) => {
        e.preventDefault();
        currentPlayer = document.getElementById('player-name').value.trim() || 'æ¸¸å®¢';
        document.getElementById('current-player').textContent = currentPlayer;
        document.getElementById('join').classList.add('hidden');
        document.getElementById('game').classList.remove('hidden');
        startGame();
      });

      // ä¿å­˜æˆç»©
      document.getElementById('save-score').addEventListener('click', saveScore);

      // åŠ è½½æ’è¡Œæ¦œ
      loadRanking();
    });

    // å¼€å§‹æ¸¸æˆ
    function startGame() {
      gameState = 'playing';
      foundCount = 0;
      currentCharIndex = 0;
      document.getElementById('found-count').textContent = foundCount;
      document.getElementById('game-over').classList.add('hidden');
      document.getElementById('game-content').classList.remove('hidden');

      // è®¡æ—¶å™¨é‡ç½®
      timeLeft = 60;
      document.getElementById('time-left').textContent = timeLeft;
      document.getElementById('progress-bar').style.width = '100%';
      clearInterval(timer);
      timer = setInterval(updateTimer, 1000);

      // ç”Ÿæˆæ‰­æ›²æ–‡å­—
      generateTwistedChars();
    }

    // ç”Ÿæˆæ‰­æ›²æ–‡å­—
    function generateTwistedChars() {
      const grid = document.getElementById('game-content');
      grid.innerHTML = '';
      charGrid = [];

      // é€‰ç›®æ ‡å§“å
      selectTargetName();

      // ç”Ÿæˆå­—ç¬¦æ± ï¼ˆç›®æ ‡+å¹²æ‰°ï¼Œå…±16ä¸ªï¼‰
      const chars = [...targetChars];
      while (chars.length < 16) {
        chars.push(commonChars[Math.floor(Math.random() * commonChars.length)]);
      }

      // æ´—ç‰Œæ‰“ä¹±
      shuffleArray(chars);

      // åˆ›å»ºå…¨éšæœºæ—‹è½¬çš„å­—ç¬¦
      chars.forEach(char => {
        const tile = document.createElement('div');
        tile.className = 'char-tile';
        tile.textContent = char;

        // æ—‹è½¬è§’åº¦ï¼š-360Â° ~ 360Â° å®Œå…¨éšæœº
        const rotate = Math.random() * 720 - 360;
        const skew = Math.random() * 40 - 20;     // å€¾æ–œ
        const scale = Math.random() * 0.4 + 0.8;  // ç¼©æ”¾
        const translateX = Math.random() * 10 - 5;// ä½ç§»
        const translateY = Math.random() * 10 - 5;// ä½ç§»

        tile.style.transform = `
          rotate(${rotate}deg) 
          skewX(${skew}deg) 
          scale(${scale})
          translate(${translateX}px, ${translateY}px)
        `;

        // ç‚¹å‡»äº‹ä»¶
        tile.addEventListener('click', () => checkChar(tile));

        grid.appendChild(tile);
        charGrid.push(tile);
      });
    }

    // é€‰æ‹©ç›®æ ‡å§“å
    function selectTargetName() {
      const randomName = nameList[Math.floor(Math.random() * nameList.length)];
      targetChars = randomName.split('');
      document.getElementById('target-name').textContent = randomName;
    }

    // æ£€æŸ¥ç‚¹å‡»çš„å­—ç¬¦ï¼ˆå«ç‚¹é”™æƒ©ç½šï¼‰
    function checkChar(tile) {
      if (gameState !== 'playing') return;
      const char = tile.textContent;

      if (char === targetChars[currentCharIndex]) {
        // æ­£ç¡®ç‚¹å‡»
        tile.classList.add('char-tile-selected');
        setTimeout(() => {
          tile.classList.add('char-tile-found');
          currentCharIndex++;

          if (currentCharIndex >= targetChars.length) {
            foundCount++;
            document.getElementById('found-count').textContent = foundCount;
            currentCharIndex = 0;

            // éšè—å·²æ‰¾åˆ°çš„å­—ç¬¦
            charGrid.forEach(t => {
              if (targetChars.includes(t.textContent)) {
                t.classList.add('char-tile-found');
              }
            });

            // åˆ·æ–°æ–°å§“å
            setTimeout(() => {
              generateTwistedChars();
            }, 1000);
          }
        }, 300);
      } else {
        // ğŸ”¥ ç‚¹é”™æƒ©ç½šï¼šæ—¶é—´å‡å°‘1ç§’ ğŸ”¥
        timeLeft = Math.max(0, timeLeft - 10); // ç¡®ä¿æ—¶é—´ä¸å°äº0
        document.getElementById('time-left').textContent = timeLeft;
        
        // è§†è§‰åé¦ˆï¼šç‚¹é”™çš„å­—ç¬¦å˜çº¢é—ªçƒ
        tile.classList.add('char-tile-wrong');
        setTimeout(() => {
          tile.classList.remove('char-tile-wrong');
        }, 300);
        
        // æ£€æŸ¥æ˜¯å¦å› æƒ©ç½šå¯¼è‡´æ—¶é—´è€—å°½
        if (timeLeft <= 0) {
          endGame();
        }
      }
    }

    // æ›´æ–°è®¡æ—¶å™¨
    function updateTimer() {
      timeLeft--;
      document.getElementById('time-left').textContent = timeLeft;
      const progress = (timeLeft / 60) * 100;
      document.getElementById('progress-bar').style.width = `${progress}%`;

      if (timeLeft <= 0) {
        endGame();
      }
    }

    // ç»“æŸæ¸¸æˆ
    function endGame() {
      gameState = 'ended';
      clearInterval(timer);
      
      // éšè—æ¸¸æˆå†…å®¹ï¼Œæ˜¾ç¤ºç»“æœ
      document.getElementById('game-content').classList.add('hidden');
      document.getElementById('game-over').classList.remove('hidden');
      document.getElementById('final-count').textContent = foundCount;
    }

    // ä¿å­˜æˆç»©
    async function saveScore() {
      const player = currentPlayer || 'æ¸¸å®¢';
      const score = foundCount;
      const time = new Date().toLocaleString();
      
      // è®¾ç½®éšè—è¡¨å•çš„å€¼
      document.querySelector('input[name="player"]').value = player;
      document.querySelector('input[name="score"]').value = score;
      document.querySelector('input[name="time"]').value = time;
      
      // æäº¤è¡¨å•ï¼ˆNetlifyä¼šè‡ªåŠ¨å¤„ç†ï¼‰
      document.querySelector('form[name="rankings"]').submit();
      
      alert('æˆç»©ä¿å­˜æˆåŠŸï¼');
      loadRanking(); // åˆ·æ–°æ’è¡Œæ¦œ
    }

    // åŠ è½½æ’è¡Œæ¦œ
    async function loadRanking() {
      try {
        const functionUrl = '/.netlify/functions/loadRanking';
        console.log('è¯·æ±‚URL:', functionUrl); // ç¡®è®¤è¯·æ±‚è·¯å¾„

        const response = await fetch(functionUrl);
        
        // æ–°å¢ï¼šæ‰“å°å“åº”å¤´ä¿¡æ¯ï¼ˆç”¨äºè°ƒè¯•ï¼‰
        console.log('å“åº”çŠ¶æ€:', response.status);
        console.log('å“åº”Content-Type:', response.headers.get('Content-Type'));
        
        // è¯»å–åŸå§‹å“åº”å†…å®¹ï¼ˆé‡è¦ï¼ç”¨äºè°ƒè¯•ï¼‰
        const rawText = await response.text();
        console.log('åŸå§‹å“åº”å†…å®¹:', rawText);
        
        // æ‰‹åŠ¨è§£æJSONï¼Œæ•è·è§£æé”™è¯¯
        const rankings = JSON.parse(rawText);
        
        // æ¸²æŸ“æ’è¡Œæ¦œ
        const body = document.getElementById('ranking-body');
        body.innerHTML = '';
        
        if (rankings.length === 0) {
          body.innerHTML = '<tr><td colspan="4" class="text-center py-6 text-gray-400">æš‚æ— æ•°æ®</td></tr>';
          return;
        }
        
        // æ¸²æŸ“æ•°æ®ï¼ˆæ·»åŠ å®‰å…¨æ£€æŸ¥ï¼Œé˜²æ­¢æ„å¤–æ ¼å¼é”™è¯¯ï¼‰
        rankings.forEach((item, index) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="px-4 py-2">${index + 1}</td>
            <td class="px-4 py-2">${item.player || 'æœªçŸ¥'}</td>
            <td class="px-4 py-2">${item.score || 0}</td>
            <td class="px-4 py-2">${item.time || 'æœªçŸ¥æ—¶é—´'}</td>
          `;
          body.appendChild(row);
        });
      } catch (error) {
        console.error('æ’è¡Œæ¦œåŠ è½½å¤±è´¥è¯¦æƒ…:', error);
        alert(`åŠ è½½æ’è¡Œæ¦œæ—¶å‡ºé”™ï¼š${error.message}`);
      }
    }
    //68542d4d1aba6e0008922d8a
    //nfp_nZFbzjLbgvGWnjK1u3TWUoTBQYyZTNAk3021
    // æ•°ç»„æ´—ç‰Œ
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
  </script>
  <form name="rankings" method="POST" netlify hidden>
  <input type="hidden" name="player" />
  <input type="hidden" name="score" />
  <input type="hidden" name="time" />
</form>
</body>
</html>
